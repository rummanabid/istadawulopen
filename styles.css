function getCurrentAST() {
  const now = new Date();
  const utc = now.getTime() + now.getTimezoneOffset() * 60000;
  return new Date(utc + 3 * 3600000); // UTC+3 for AST
}

const openHour = 10;
const openMinute = 0;
const closeHour = 15;
const closeMinute = 0;

function updateMarketStatus() {
  const now = getCurrentAST();
  const statusElement = document.getElementById("market-status");
  const countdownElement = document.getElementById("countdown");
  const statusElementAr = document.getElementById("market-status-ar");
  const countdownElementAr = document.getElementById("countdown-ar");

  let targetTime;
  let statusText, statusTextAr;
  let timerLabel, timerLabelAr;

  const openTime = new Date(now);
  openTime.setHours(openHour, openMinute, 0, 0);

  const closeTime = new Date(now);
  closeTime.setHours(closeHour, closeMinute, 0, 0);

  if (now >= openTime && now < closeTime) {
    statusText = "Market Open";
    statusTextAr = "السوق مفتوح";
    timerLabel = "Market closing in: ";
    timerLabelAr = "يغلق السوق بعد: ";
    targetTime = closeTime;

    statusElement.style.color = "green";
    countdownElement.style.color = "green";
    statusElementAr.style.color = "green";
    countdownElementAr.style.color = "green";
  } else {
    statusText = "Market Closed";
    statusTextAr = "السوق مغلق";
    timerLabel = "Market opening in: ";
    timerLabelAr = "يفتح السوق بعد: ";
    statusElement.style.color = "red";
    statusElementAr.style.color = "red";
    countdownElement.style.color = "black";
    countdownElementAr.style.color = "black";

    if (now < openTime) {
      targetTime = openTime;
    } else {
      targetTime = new Date(openTime);
      targetTime.setDate(openTime.getDate() + 1);
    }
  }

  const distance = Math.max(0, targetTime - now);
  const hours = Math.floor((distance / (1000 * 60 * 60)) % 24);
  const minutes = Math.floor((distance / (1000 * 60)) % 60);
  const seconds = Math.floor((distance / 1000) % 60);

  statusElement.innerText = statusText;
  countdownElement.innerText = timerLabel + `${hours}h ${minutes}m ${seconds}s`;

  statusElementAr.innerText = statusTextAr;
  countdownElementAr.innerText = timerLabelAr + `${hours} ساعة ${minutes} دقيقة ${seconds} ثانية`;
}

updateMarketStatus();
setInterval(updateMarketStatus, 1000);
